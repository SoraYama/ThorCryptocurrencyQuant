# ThorCryptoCurrency Strategy Library 安装运行指南

## 部署方式选择

本项目支持两种部署方式：

1. **Docker 容器化部署（推荐）**：适合生产环境，部署简单，环境隔离
2. **传统部署方式**：适合开发环境，需要手动配置依赖

## 方式一：Docker 容器化部署（推荐）

### 系统要求

#### 操作系统
- **推荐**：Linux (Ubuntu 18.04+ / CentOS 7+)
- **支持**：macOS 10.14+
- **支持**：Windows 10+ (需要 Docker Desktop)

#### 硬件要求
- **CPU**：2核心以上
- **内存**：4GB以上
- **存储**：10GB可用空间
- **网络**：稳定的互联网连接

### 环境准备

#### 1. 安装 Docker 和 Docker Compose

##### Ubuntu/Debian 系统
```bash
# 更新包管理器
sudo apt update

# 安装 Docker
sudo apt install docker.io docker-compose

# 启动 Docker 服务
sudo systemctl start docker
sudo systemctl enable docker

# 将当前用户添加到 docker 组（可选）
sudo usermod -aG docker $USER

# 验证安装
docker --version
docker-compose --version
```

##### CentOS/RHEL 系统
```bash
# 安装 Docker
sudo yum install docker docker-compose

# 启动 Docker 服务
sudo systemctl start docker
sudo systemctl enable docker

# 将当前用户添加到 docker 组（可选）
sudo usermod -aG docker $USER

# 验证安装
docker --version
docker-compose --version
```

##### macOS 系统
```bash
# 使用 Homebrew 安装
brew install docker docker-compose

# 或者下载 Docker Desktop for Mac
# 访问 https://www.docker.com/products/docker-desktop
```

##### Windows 系统
1. 访问 [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop)
2. 下载并安装 Docker Desktop
3. 安装完成后，Docker Compose 会自动包含

#### 2. 创建数据目录
```bash
# 创建 MongoDB 数据目录
sudo mkdir -p /data/docker/ThorCQ/mongo
sudo chown -R $USER:$USER /data/docker/ThorCQ
```

### 项目安装

#### 1. 克隆项目
```bash
# 克隆项目到本地
git clone https://github.com/your-username/ThorCryptocurrencyQuant.git

# 进入项目目录
cd ThorCryptocurrencyQuant
```

#### 2. 配置环境变量
```bash
# 复制环境变量模板
cp env.example .env

# 编辑环境变量文件
nano .env
```

#### 3. 配置 API 信息
编辑 `.env` 文件，填入您的 API 信息：

```bash
# 交易所配置
EXCHANGE=binance
API_KEY=your_binance_api_key_here
API_SECRET=your_binance_secret_here

# 交易配置
ORDER_SYMBOL=ETH/USDT
ORDER_TYPE=limit

# 网格策略参数
NUM_BUY=3
NUM_SELL=1
ORDER_SPREAD=0.5
ORDER_PROFIT=0.5
ORDER_AMOUNT_BUY=30
ORDER_AMOUNT_SELL=30

# 数据库配置
MONGO_URI=mongodb://admin:thorcq123@mongo:27017/binance?authSource=admin
MONGO_HOST=mongo
MONGO_PORT=27017
MONGO_DB=binance
```

### 运行项目

#### 1. 启动服务
```bash
# 构建并启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f app
```

#### 2. 监控运行状态

##### 查看服务状态
```bash
# 查看所有服务状态
docker-compose ps

# 查看服务日志
docker-compose logs -f app
docker-compose logs -f mongo

# 查看实时日志
docker-compose logs --tail=100 -f app
```

##### 查看数据库状态
```bash
# 进入 MongoDB 容器
docker-compose exec mongo mongosh

# 或者直接连接
docker-compose exec mongo mongosh "mongodb://admin:thorcq123@localhost:27017/binance?authSource=admin"

# 查看订单数据
use binance
db['ETH/USDT'].find().pretty()
```

#### 3. 管理服务
```bash
# 停止服务
docker-compose down

# 重启服务
docker-compose restart

# 重新构建并启动
docker-compose up -d --build

# 查看资源使用情况
docker stats
```

## 方式二：传统部署方式

### 系统要求

### 操作系统
- **推荐**：Linux (Ubuntu 18.04+ / CentOS 7+)
- **支持**：macOS 10.14+
- **支持**：Windows 10+ (需要额外配置)

### 硬件要求
- **CPU**：2核心以上
- **内存**：4GB以上
- **存储**：10GB可用空间
- **网络**：稳定的互联网连接

## 环境准备

### 1. Python 环境安装

#### Ubuntu/Debian 系统
```bash
# 更新包管理器
sudo apt update

# 安装 Python 3.8+ 和 pip
sudo apt install python3 python3-pip python3-venv

# 验证安装
python3 --version
pip3 --version
```

#### CentOS/RHEL 系统
```bash
# 安装 EPEL 仓库
sudo yum install epel-release

# 安装 Python 3.8+ 和 pip
sudo yum install python3 python3-pip

# 验证安装
python3 --version
pip3 --version
```

#### macOS 系统
```bash
# 使用 Homebrew 安装
brew install python3

# 验证安装
python3 --version
pip3 --version
```

#### Windows 系统
1. 访问 [Python官网](https://www.python.org/downloads/)
2. 下载 Python 3.8+ 版本
3. 安装时勾选 "Add Python to PATH"
4. 验证安装：
```cmd
python --version
pip --version
```

### 2. MongoDB 数据库安装

#### Ubuntu/Debian 系统
```bash
# 导入 MongoDB 公钥
wget -qO - https://www.mongodb.org/static/pgp/server-5.0.asc | sudo apt-key add -

# 添加 MongoDB 仓库
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/5.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list

# 更新包列表并安装 MongoDB
sudo apt update
sudo apt install -y mongodb-org

# 启动 MongoDB 服务
sudo systemctl start mongod
sudo systemctl enable mongod

# 验证安装
sudo systemctl status mongod
```

#### CentOS/RHEL 系统
```bash
# 创建 MongoDB 仓库文件
sudo vi /etc/yum.repos.d/mongodb-org-5.0.repo

# 添加以下内容：
[mongodb-org-5.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/5.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-5.0.asc

# 安装 MongoDB
sudo yum install -y mongodb-org

# 启动 MongoDB 服务
sudo systemctl start mongod
sudo systemctl enable mongod

# 验证安装
sudo systemctl status mongod
```

#### macOS 系统
```bash
# 使用 Homebrew 安装
brew tap mongodb/brew
brew install mongodb-community

# 启动 MongoDB 服务
brew services start mongodb/brew/mongodb-community

# 验证安装
brew services list | grep mongodb
```

#### Windows 系统
1. 访问 [MongoDB官网](https://www.mongodb.com/try/download/community)
2. 下载 Windows 版本
3. 运行安装程序，选择 "Complete" 安装
4. 安装完成后，MongoDB 会自动启动

### 3. Git 安装（如果未安装）

#### Ubuntu/Debian 系统
```bash
sudo apt install git
```

#### CentOS/RHEL 系统
```bash
sudo yum install git
```

#### macOS 系统
```bash
brew install git
```

#### Windows 系统
1. 访问 [Git官网](https://git-scm.com/download/win)
2. 下载并安装 Git for Windows

## 项目安装

### 1. 克隆项目
```bash
# 克隆项目到本地
git clone https://github.com/your-username/ThorCryptocurrencyQuant.git

# 进入项目目录
cd ThorCryptocurrencyQuant
```

### 2. 创建虚拟环境（推荐）
```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
# Linux/macOS:
source venv/bin/activate
# Windows:
# venv\Scripts\activate
```

### 3. 安装 Python 依赖

#### 方法一：使用 pip 安装（推荐）
```bash
# 安装核心依赖
pip install ccxt
pip install pymongo
pip install websocket-client

# 安装其他可能需要的依赖
pip install requests
pip install numpy
pip install pandas
```

#### 方法二：创建 requirements.txt 文件
```bash
# 创建 requirements.txt 文件
cat > requirements.txt << EOF
ccxt>=3.0.0
pymongo>=4.0.0
websocket-client>=1.0.0
requests>=2.25.0
numpy>=1.20.0
pandas>=1.3.0
EOF

# 安装所有依赖
pip install -r requirements.txt
```

### 4. 验证安装
```bash
# 验证 Python 包安装
python3 -c "import ccxt, pymongo, websocket; print('所有依赖安装成功！')"

# 验证 MongoDB 连接
python3 -c "import pymongo; client = pymongo.MongoClient('localhost', 27017); print('MongoDB 连接成功！')"
```

## 配置设置

### 1. 交易所 API 配置

#### 获取 API 密钥
1. 登录您选择的交易所（如 BitMEX）
2. 进入 API 管理页面
3. 创建新的 API 密钥
4. 记录 API Key 和 Secret

#### 配置 API 信息
编辑 `网格策略/bitmex_main-xbt.py` 文件：

```python
# 在文件开头修改以下配置
exchange = 'bitmex'  # 交易所名称
apiKey = 'your_api_key_here'  # 替换为您的 API Key
secret = 'your_secret_here'  # 替换为您的 API Secret
order_symbol = 'ETH/USD'  # 交易品种，可选：BTC/USD, ETH/USD
```

### 2. 策略参数配置

在 `bitmex_main-xbt.py` 文件中调整策略参数：

```python
# 网格策略参数
num_buy = 3  # 买网格数量（建议 3-10）
num_sell = 1  # 卖网格数量（建议 1-5）
order_spread = 0.5  # 网格步长（建议 0.1-2.0）
order_profit = 0.5  # 利润目标（建议 0.1-1.0）
order_amonut_buy = 30  # 买单挂单数量
order_amonut_sell = 30  # 卖单挂单数量
```

### 3. 数据库配置

确保 MongoDB 服务正在运行：
```bash
# 检查 MongoDB 状态
sudo systemctl status mongod  # Linux
brew services list | grep mongodb  # macOS
```

## 运行项目

### 1. 启动 MongoDB 服务
```bash
# Linux 系统
sudo systemctl start mongod

# macOS 系统
brew services start mongodb/brew/mongodb-community

# Windows 系统
# MongoDB 通常会自动启动
```

### 2. 运行网格策略
```bash
# 进入网格策略目录
cd 网格策略

# 运行主程序
python3 bitmex_main-xbt.py
```

### 3. 监控运行状态

#### 查看控制台输出
程序运行时会显示：
- 连接状态
- 订单创建信息
- 订单状态变化
- 错误信息（如有）

#### 查看数据库状态
```bash
# 连接 MongoDB
mongo

# 查看数据库
use bitmex

# 查看订单集合
db['ETH/USD'].find().pretty()
```

### 4. 使用 tmux 后台运行（推荐）

#### 安装 tmux
```bash
# Ubuntu/Debian
sudo apt install tmux

# CentOS/RHEL
sudo yum install tmux

# macOS
brew install tmux
```

#### 使用 tmux 运行
```bash
# 创建新的 tmux 会话
tmux new-session -d -s trading

# 进入会话
tmux attach-session -t trading

# 运行策略
cd /path/to/ThorCryptocurrencyQuant/网格策略
python3 bitmex_main-xbt.py

# 分离会话（Ctrl+B, 然后按 D）
# 重新连接会话
tmux attach-session -t trading
```

## 常见问题解决

### Docker 容器化部署问题

### 1. Docker 容器无法启动
```bash
# 检查 Docker 服务状态
sudo systemctl status docker

# 检查数据目录权限
ls -la /data/docker/ThorCQ/

# 检查端口占用
netstat -tlnp | grep 7399

# 查看详细错误信息
docker-compose logs
```

### 2. MongoDB 连接失败
```bash
# 检查 MongoDB 容器状态
docker-compose ps mongo

# 查看 MongoDB 日志
docker-compose logs mongo

# 检查网络连接
docker-compose exec app ping mongo

# 测试 MongoDB 连接
docker-compose exec mongo mongosh --eval "db.adminCommand('ping')"
```

### 3. 应用容器启动失败
```bash
# 检查环境变量配置
docker-compose exec app env | grep -E "(API_KEY|MONGO_URI)"

# 查看应用日志
docker-compose logs app

# 检查依赖安装
docker-compose exec app pip list

# 重新构建镜像
docker-compose build --no-cache app
```

### 4. 数据持久化问题
```bash
# 检查数据卷挂载
docker volume ls

# 检查数据目录
ls -la /data/docker/ThorCQ/mongo/

# 备份数据
sudo cp -r /data/docker/ThorCQ/mongo /backup/mongo-$(date +%Y%m%d)
```

### 传统部署问题

### 1. Python 依赖安装失败
```bash
# 升级 pip
pip install --upgrade pip

# 使用国内镜像源
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple ccxt pymongo websocket-client
```

### 2. MongoDB 连接失败
```bash
# 检查 MongoDB 服务状态
sudo systemctl status mongod

# 重启 MongoDB 服务
sudo systemctl restart mongod

# 检查端口是否被占用
netstat -tlnp | grep 27017
```

### 3. API 连接失败
- 检查 API Key 和 Secret 是否正确
- 确认 API 权限设置（需要交易权限）
- 检查网络连接
- 确认交易所 API 服务状态

### 4. 订单创建失败
- 检查账户余额是否充足
- 确认交易对名称是否正确
- 检查订单参数是否合理
- 查看交易所错误信息

### 5. WebSocket 连接断开
- 检查网络稳定性
- 确认防火墙设置
- 查看程序日志中的错误信息

## 安全建议

### 1. API 密钥安全
- 不要在代码中硬编码 API 密钥
- 使用环境变量存储敏感信息
- 定期轮换 API 密钥
- 限制 API 权限（只授予必要的权限）

### 2. 服务器安全
- 使用防火墙限制访问
- 定期更新系统和软件
- 使用强密码
- 启用 SSH 密钥认证

### 3. 资金安全
- 使用测试网进行策略测试
- 设置合理的资金限额
- 定期备份重要数据
- 监控异常交易活动

## 性能优化

### 1. 系统优化
```bash
# 增加文件描述符限制
echo "* soft nofile 65536" >> /etc/security/limits.conf
echo "* hard nofile 65536" >> /etc/security/limits.conf

# 优化网络参数
echo "net.core.rmem_max = 16777216" >> /etc/sysctl.conf
echo "net.core.wmem_max = 16777216" >> /etc/sysctl.conf
```

### 2. MongoDB 优化
```bash
# 编辑 MongoDB 配置文件
sudo vi /etc/mongod.conf

# 添加以下配置
storage:
  wiredTiger:
    engineConfig:
      cacheSizeGB: 1  # 根据内存大小调整
```

### 3. Python 优化
```bash
# 安装性能优化包
pip install cython
pip install numpy
```

## 监控和维护

### 1. 日志监控
```bash
# 查看系统日志
tail -f /var/log/syslog

# 查看 MongoDB 日志
tail -f /var/log/mongodb/mongod.log
```

### 2. 性能监控
```bash
# 监控系统资源
htop

# 监控网络连接
netstat -tlnp

# 监控磁盘使用
df -h
```

### 3. 定期维护
- 定期清理日志文件
- 监控磁盘空间使用
- 更新系统和软件包
- 备份重要数据

## 技术支持

### 1. 官方资源
- GitHub Issues：提交问题和建议
- 官方文档：查看详细文档
- 社区论坛：与其他用户交流

### 2. 联系方式
- 微信：3404034
- 邮箱：block@163.com
- GitHub：提交 Issue

### 3. 贡献代码
- Fork 项目
- 创建功能分支
- 提交 Pull Request
- 参与代码审查

## 免责声明

本项目仅供学习和研究使用，不构成投资建议。使用本项目进行实际交易的所有风险由用户自行承担。请在充分了解风险的前提下谨慎使用。

---

**注意**：在开始使用前，强烈建议先在测试环境中运行策略，熟悉系统操作和风险控制，然后再考虑在实盘环境中使用。
